(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7502:function(e,t,n){Promise.resolve().then(n.bind(n,2590))},2590:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var s=n(7437),i=n(2265);let r=n(357).env.NEXT_PUBLIC_API_BASE_URL||"https://instagram-bot-xmt8.onrender.com";function o(){var e,t;let[n,o]=(0,i.useState)("login"),[a,d]=(0,i.useState)(""),[l,c]=(0,i.useState)(""),[u,h]=(0,i.useState)("reviewer@example.com"),[g,p]=(0,i.useState)("Reviewer123"),[m,f]=(0,i.useState)([]),[x,y]=(0,i.useState)(""),[v,j]=(0,i.useState)(null),[b,w]=(0,i.useState)(null),[S,T]=(0,i.useState)(""),[z,C]=(0,i.useState)(!1),[k,I]=(0,i.useState)([]),[B,_]=(0,i.useState)(""),[D,R]=(0,i.useState)(null),[E,L]=(0,i.useState)([]),[P,W]=(0,i.useState)(""),[A,N]=(0,i.useState)(!1),[U,F]=(0,i.useState)(""),[M,O]=(0,i.useState)(""),H="#f5cd4c",J="#000000";(0,i.useEffect)(()=>{document.body.style.backgroundColor="#f0e9d3"},[]);let q=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=await fetch("".concat(r).concat(e),{...t,headers:{"Content-Type":"application/json",...t.headers||{},...a?{Authorization:"Bearer ".concat(a)}:{}}}),s=await n.json().catch(()=>({}));if(!n.ok){var i,o;let e=Error(s.message||(null===(i=s.error)||void 0===i?void 0:i.message)||(null===(o=s.errors)||void 0===o?void 0:o[0])||"Request failed with ".concat(n.status));throw e.status=n.status,e.data=s,e}return s},Y=async e=>{e.preventDefault(),c("");try{let e=await q("/v1/auth/login",{method:"POST",body:JSON.stringify({email:u,password:g}),headers:{"Content-Type":"application/json"}});d(e.tokens.access.token),o("accounts")}catch(e){c(e.message)}},V=async()=>{y("");try{let e=await q("/v1/instagram");f(e)}catch(e){y(e.message)}},G=async e=>{C(!0),T("");try{let t=await q("/v1/instagram/".concat(e.id,"/profile"));w(t)}catch(e){T(e.message)}finally{C(!1)}},X=async e=>{j(e),R(null),L([]),w(null),o("conversations"),await Q(e),await G(e)},K=async e=>{R(e),await Z(e.id)},Q=async e=>{_("");try{let t=await q("/v1/conversations/".concat(e.id));I(t)}catch(e){_(e.message)}},Z=async e=>{W("");try{let t=await q("/v1/messages/".concat(e));L([...t].reverse())}catch(e){W(e.message)}};(0,i.useEffect)(()=>{if("conversations"!==n||!v)return;let e=setInterval(async()=>{N(!0),await Q(v),N(!1)},8e3);return()=>clearInterval(e)},[n,v,a]),(0,i.useEffect)(()=>{if(!(null==D?void 0:D.id))return;let e=setInterval(async()=>{await Z(D.id)},5e3);return Z(D.id),()=>clearInterval(e)},[null==D?void 0:D.id,a]);let $=async e=>{if(e.preventDefault(),v&&D&&U.trim()){O("Sending…");try{await q("/v1/messages/".concat(D.id),{method:"POST",body:JSON.stringify({text:U.trim()})}),O("✅ Message sent successfully!"),F(""),await Q(v),(null==D?void 0:D.id)&&await Z(D.id)}catch(i){var t;let e=i.message||"";e.toLowerCase();let n=((null===(t=(i.data||{}).error)||void 0===t?void 0:t.message)||"").toLowerCase(),s="".concat(e," ").concat(n).toLowerCase();s.includes("permission")||s.includes("instagram_manage_messages")||s.includes("requires")||s.includes("capability")||s.includes("advanced access")||s.includes("(#200)")||s.includes("(#10)")||s.includes("endpoint requires")||s.includes("does not have the capability")?O("❌ Cannot send: The instagram_manage_messages permission is not yet approved by Meta. This is expected during App Review - once the permission is granted, this same API call will work successfully."):s.includes("forbidden")||403===i.status?O("❌ Cannot send: Permission denied. The instagram_manage_messages permission may not be approved yet."):O("❌ Send failed: ".concat(i.message))}}},ee=(0,s.jsx)("div",{style:{background:H,borderBottom:"1px solid rgba(0,0,0,0.08)"},children:(0,s.jsx)("div",{style:{maxWidth:900,margin:"0 auto",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,s.jsx)("div",{style:{fontWeight:700,color:J},children:"Instagram DM"})})});return(0,s.jsxs)(s.Fragment,{children:[ee,(0,s.jsx)("main",{style:{padding:"16px 12px 40px"},children:(0,s.jsxs)("section",{style:{maxWidth:900,margin:"24px auto",padding:24,borderRadius:12,background:"white",boxShadow:"0 12px 30px rgba(0,0,0,0.08)"},children:["login"===n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{style:{marginTop:0,color:J},children:"Step 1 \xb7 Login (JWT)"}),(0,s.jsxs)("p",{style:{fontSize:14,color:"#555"},children:["This form calls ",(0,s.jsx)("code",{children:"/v1/auth/login"})," on the backend and stores the"," ",(0,s.jsx)("code",{children:"access.token"}),". Meta reviewers can use the same credentials:"]}),(0,s.jsxs)("ul",{style:{fontSize:14,color:"#333"},children:[(0,s.jsxs)("li",{children:["Email: ",(0,s.jsx)("code",{children:"reviewer@example.com"})]}),(0,s.jsxs)("li",{children:["Password: ",(0,s.jsx)("code",{children:"Reviewer123"})]})]}),(0,s.jsxs)("form",{onSubmit:Y,style:{marginTop:16},children:[(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"Email"}),(0,s.jsx)("input",{value:u,onChange:e=>h(e.target.value),type:"email",style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"1px solid #ccc"}})]}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("label",{style:{display:"block",fontSize:13,marginBottom:4},children:"Password"}),(0,s.jsx)("input",{value:g,onChange:e=>p(e.target.value),type:"password",style:{width:"100%",padding:"8px 10px",borderRadius:6,border:"1px solid #ccc"}})]}),l&&(0,s.jsx)("p",{style:{color:"red",fontSize:13,marginBottom:8},children:l}),(0,s.jsx)("button",{type:"submit",style:{background:J,color:"white",border:"none",padding:"8px 16px",borderRadius:999,cursor:"pointer",fontSize:14},children:"Login and fetch accounts"})]})]}),"accounts"===n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{style:{marginTop:0,color:J},children:"Step 2 \xb7 Connected Instagram account"}),(0,s.jsxs)("p",{style:{fontSize:14,color:"#555"},children:["This view calls ",(0,s.jsx)("code",{children:"/v1/instagram"})," with the JWT and shows the connected business account."]}),(0,s.jsx)("button",{onClick:V,style:{background:J,color:"white",border:"none",padding:"6px 14px",borderRadius:999,cursor:"pointer",fontSize:13,marginBottom:12},children:"Load accounts"}),x&&(0,s.jsx)("p",{style:{color:"red",fontSize:13,marginBottom:8},children:x}),(0,s.jsxs)("div",{children:[m.map(e=>(0,s.jsxs)("div",{style:{borderRadius:8,border:"1px solid #ddd",padding:12,marginBottom:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:600},children:e.username||e.instagramBusinessId}),(0,s.jsxs)("div",{style:{fontSize:12,color:"#777"},children:["ID: ",(0,s.jsx)("code",{children:e.instagramBusinessId})]})]}),(0,s.jsx)("button",{onClick:()=>X(e),style:{background:H,border:"none",padding:"6px 12px",borderRadius:999,cursor:"pointer",fontSize:13},children:"View conversations"})]},e.id)),0===m.length&&!x&&(0,s.jsx)("p",{style:{fontSize:13,color:"#666"},children:"No accounts loaded yet."})]})]}),"conversations"===n&&v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{marginTop:0,color:J},children:"Step 3 \xb7 Conversations & messages"}),(0,s.jsxs)("p",{style:{fontSize:14,color:"#555"},children:["This view calls ",(0,s.jsx)("code",{children:"/v1/conversations/<accountId>"})," to list conversations. Each conversation shows the username fetched via"," ",(0,s.jsx)("code",{children:"instagram_basic"})," plus recent messages received via"," ",(0,s.jsx)("code",{children:"instagram_manage_messages"}),". Auto-refreshes every 8 seconds."]}),v&&(0,s.jsxs)("div",{style:{marginTop:8,fontSize:13,fontWeight:600,color:J},children:["\uD83D\uDCF1 Account: @",v.username||v.instagramBusinessId," (ID: ",v.instagramBusinessId,")"]})]}),A&&(0,s.jsx)("span",{style:{fontSize:12,color:"#666"},children:"\uD83D\uDD04 Refreshing..."})]}),v&&(0,s.jsxs)("div",{style:{marginBottom:16,padding:16,borderRadius:8,border:"2px solid #f5cd4c",background:"#fffef5"},children:[(0,s.jsxs)("h3",{style:{marginTop:0,fontSize:16,color:J},children:["\uD83D\uDCCA Profile Details for @",v.username||v.instagramBusinessId," (via instagram_basic permission)"]}),z&&(0,s.jsx)("p",{style:{fontSize:13,color:"#666"},children:"Loading profile..."}),S&&(0,s.jsxs)("p",{style:{color:"red",fontSize:13},children:["Error loading profile: ",S]}),b&&(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:12,fontSize:13},children:[b.profilePictureUrl&&(0,s.jsx)("img",{src:b.profilePictureUrl,alt:"Profile",style:{width:80,height:80,borderRadius:"50%",border:"2px solid #f5cd4c",gridRow:"span 4"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Handle:"})," @",b.username]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Name:"})," ",b.name||"N/A"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Bio:"})," ",b.biography||"No bio"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Followers:"})," ",(null===(e=b.followersCount)||void 0===e?void 0:e.toLocaleString())||0]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Posts:"})," ",b.mediaCount||0]}),b.website&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Website:"})," ",(0,s.jsx)("a",{href:b.website,target:"_blank",rel:"noopener noreferrer",style:{color:"#0066cc"},children:b.website})]}),(0,s.jsxs)("div",{style:{gridColumn:"span 2",marginTop:8},children:[(0,s.jsxs)("strong",{children:["Recent Media for @",b.username," (via instagram_basic):"]}),b.media&&b.media.length>0?(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:8,marginTop:8},children:b.media.map(e=>(0,s.jsxs)("div",{style:{aspectRatio:"1",borderRadius:4,overflow:"hidden",border:"1px solid #ddd",background:"#f5f5f5",position:"relative"},children:[e.media_url&&(0,s.jsx)("img",{src:e.media_url,alt:e.caption||"Post",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.media_type&&(0,s.jsx)("div",{style:{position:"absolute",top:4,right:4,background:"rgba(0,0,0,0.6)",color:"white",fontSize:10,padding:"2px 4px",borderRadius:3},children:"VIDEO"===e.media_type?"▶":"\uD83D\uDCF7"})]},e.id))}):(0,s.jsx)("p",{style:{fontSize:12,color:"#666",marginTop:4},children:"No media found"})]})]})]}),(0,s.jsx)("button",{onClick:()=>o("accounts"),style:{background:"transparent",color:J,border:"1px solid #ccc",padding:"4px 10px",borderRadius:999,cursor:"pointer",fontSize:12,marginBottom:12},children:"← Back to accounts"}),B&&(0,s.jsx)("p",{style:{color:"red",fontSize:13,marginBottom:8},children:B}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1.3fr) minmax(0, 1.7fr)",gap:16},children:[(0,s.jsxs)("div",{style:{borderRadius:8,border:"1px solid #eee",maxHeight:260,overflowY:"auto",padding:8,background:"#faf7ee"},children:[k.map(e=>{var t;return(0,s.jsxs)("div",{onClick:()=>K(e),style:{padding:8,borderRadius:6,marginBottom:6,cursor:"pointer",background:D&&D.id===e.id?H:"white",border:"1px solid #e2d5aa",fontSize:13,position:"relative"},children:[(0,s.jsxs)("div",{style:{fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("span",{children:["@",e.igUsername||"user_".concat(null===(t=e.igUserId)||void 0===t?void 0:t.slice(-6))]}),e.unreadCount>0&&(0,s.jsx)("span",{style:{background:"#ff4444",color:"white",borderRadius:"50%",width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},children:e.unreadCount})]}),(0,s.jsx)("div",{style:{color:"#555",marginTop:2,fontSize:12},children:e.lastMessage||"(no preview)"})]},e.id)}),0===k.length&&!B&&(0,s.jsx)("p",{style:{fontSize:13,color:"#666",padding:8},children:"No conversations yet. Send a DM to this Instagram business account from your phone to create one."})]}),(0,s.jsx)("div",{style:{borderRadius:8,border:"1px solid #eee",padding:10,background:"white",minHeight:220,display:"flex",flexDirection:"column"},children:D?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:{marginBottom:8,borderBottom:"1px solid #eee",paddingBottom:8},children:[(0,s.jsxs)("div",{style:{fontWeight:600,fontSize:14},children:["Conversation with @",D.igUsername||"user_".concat(null===(t=D.igUserId)||void 0===t?void 0:t.slice(-6))]}),(0,s.jsxs)("div",{style:{fontSize:12,color:"#777"},children:["igUserId: ",(0,s.jsx)("code",{children:D.igUserId})]}),v&&(0,s.jsxs)("div",{style:{fontSize:12,color:J,marginTop:4,fontWeight:600},children:["\uD83D\uDCF1 Sending from: @",v.username||v.instagramBusinessId," (ID: ",v.instagramBusinessId,")"]})]}),(0,s.jsxs)("div",{style:{flex:1,overflowY:"auto",maxHeight:300,marginBottom:12,padding:"8px 0",border:"1px solid #f0f0f0",borderRadius:6,background:"#fafafa"},children:[P&&(0,s.jsx)("p",{style:{color:"red",fontSize:12,padding:8},children:P}),0===E.length&&!P&&(0,s.jsx)("p",{style:{fontSize:12,color:"#666",padding:8,textAlign:"center"},children:"No messages yet. Messages will appear here when received via webhook."}),E.map(e=>{var t;return(0,s.jsxs)("div",{style:{padding:"6px 10px",margin:"4px 8px",borderRadius:8,background:"user"===e.sender?"#e3f2fd":"#fff9c4",alignSelf:"user"===e.sender?"flex-start":"flex-end",maxWidth:"80%",fontSize:13},children:[(0,s.jsx)("div",{style:{fontWeight:600,fontSize:11,color:"#666",marginBottom:2},children:"user"===e.sender?"Customer (@".concat(D.igUsername||"user_".concat(null===(t=D.igUserId)||void 0===t?void 0:t.slice(-6)),")"):"You (from @".concat((null==v?void 0:v.username)||(null==v?void 0:v.instagramBusinessId),")")}),(0,s.jsx)("div",{style:{color:"#333"},children:e.text||"(no text)"}),e.attachments&&e.attachments.length>0&&(0,s.jsxs)("div",{style:{fontSize:11,color:"#777",marginTop:4},children:["\uD83D\uDCCE ",e.attachments.length," attachment(s)"]}),(0,s.jsx)("div",{style:{fontSize:10,color:"#999",marginTop:4},children:new Date(e.timestamp).toLocaleTimeString()})]},e.id)})]}),(0,s.jsxs)("form",{onSubmit:$,style:{marginTop:"auto"},children:[(0,s.jsxs)("label",{style:{display:"block",fontSize:13,marginBottom:4},children:["Send reply from @",(null==v?void 0:v.username)||(null==v?void 0:v.instagramBusinessId)," (uses ",(0,s.jsx)("code",{children:"instagram_manage_messages"}),")"]}),(0,s.jsx)("textarea",{value:U,onChange:e=>F(e.target.value),rows:2,style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #ccc",resize:"vertical",fontSize:13},placeholder:"Type a reply to send via the Graph API…"}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)("button",{type:"submit",style:{background:J,color:"white",border:"none",padding:"6px 14px",borderRadius:999,cursor:"pointer",fontSize:13},children:"Send reply"}),M&&(0,s.jsx)("span",{style:{fontSize:12,color:"#555"},children:M})]})]})]}):(0,s.jsx)("p",{style:{fontSize:13,color:"#666"},children:"Select a conversation from the left to see messages and send a reply."})})]})]})]})})]})}},357:function(e,t,n){"use strict";var s,i;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,s,i=e.exports={};function r(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var d=[],l=!1,c=-1;function u(){l&&s&&(l=!1,s.length?d=s.concat(d):c=-1,d.length&&h())}function h(){if(!l){var e=a(u);l=!0;for(var t=d.length;t;){for(s=d,d=[];++c<t;)s&&s[c].run();c=-1,t=d.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new g(e,t)),1!==d.length||l||a(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={exports:{}},o=!0;try{t[e](r,r.exports,s),o=!1}finally{o&&delete n[e]}return r.exports}s.ab="//";var i=s(229);e.exports=i}()}},function(e){e.O(0,[971,23,744],function(){return e(e.s=7502)}),_N_E=e.O()}]);